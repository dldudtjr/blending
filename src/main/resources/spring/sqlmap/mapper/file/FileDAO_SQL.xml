<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Wed May 11 15:49:38
	KST 2016 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fileDAO">

	<select id="getFileLst" parameterType="net.app.file.vo.FileVO"
		resultType="net.app.file.vo.FileVO">
		SELECT FILE_ID
			  ,PARNTS_DTA_ID
              ,SAVE_FILE_PATH
              ,CHANGE_FILE_NM
              ,REAL_FILE_NM
			  ,REGIST_ID
			  ,TO_CHAR(REGIST_DT,'YYYY-MM-DD')AS REGIST_DT
			  ,UPDT_ID
			  ,TO_CHAR(UPDT_DT,'YYYY-MM-DD')AS UPDT_DT
			  ,TX_HASH
		FROM  TB_ATCHMNFL
		WHERE PARNTS_DTA_ID = #{parntsDtaId}
		<if test="fileId != null and fileId != ''">
			AND FILE_ID = #{fileId}
		</if>
	</select>

	<insert id="insFileDo" parameterType="net.app.file.vo.FileVO">
		<selectKey order="BEFORE" resultType="string" keyProperty="fileId"><!-- 첨부구분코드(1)+등록일자(8)+시퀀스(5) -->
			SELECT 'file' || TO_CHAR(SYSDATE, 'YYYY') || LPAD(NVL(Max(SUBSTR(FILE_ID,9))+1,1),6,'0') FROM TB_ATCHMNFL
			WHERE TO_CHAR(SYSDATE, 'YYYY') = SUBSTR(FILE_ID,5,4)
		</selectKey>
		INSERT INTO TB_ATCHMNFL (  FILE_ID
									,PARNTS_DTA_ID
									,SAVE_FILE_PATH
									,CHANGE_FILE_NM
									,REAL_FILE_NM
									,REGIST_ID
									,REGIST_DT
									,UPDT_ID
									,UPDT_DT
									,TX_HASH
									)
					VALUES( #{fileId}
					       ,#{parntsDtaId}
					       ,#{saveFilePath}
					       ,#{changeFileNm}
                           ,#{realFileNm}
                           ,#{registId}
						   ,SYSDATE
						   ,#{updtId}
						   ,SYSDATE
						   ,#{txHash}
						   )
	</insert>

	<update id="delFileDo" parameterType="net.app.file.vo.FileVO">
		UPDATE	TB_ATCHMNFL
		   SET	USE_YN = #{useYn}
		 WHERE  FILE_ID = #{fileId}
	</update>
</mapper>